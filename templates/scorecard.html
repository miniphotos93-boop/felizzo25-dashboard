<!DOCTYPE html>
<html>
<head>
    <title>Scorecard - {{ event.Event }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Poppins', sans-serif; 
            background: #000;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(10px); padding: 30px; border-radius: 20px; border: 2px solid rgba(255, 215, 0, 0.3); }
        h1 { color: #ff00ff; text-align: center; margin-bottom: 10px; font-size: 32px; text-shadow: 0 0 10px rgba(255, 0, 255, 0.8); }
        h2 { color: #00ffff; margin: 30px 0 15px; font-size: 20px; text-shadow: 0 0 10px rgba(0, 255, 255, 0.8); }
        .back-btn { display: inline-block; padding: 10px 20px; background: linear-gradient(135deg, #ff00ff, #00ffff); color: #fff; text-decoration: none; border-radius: 25px; font-weight: 700; margin-bottom: 20px; }
        .judges-form { background: rgba(255, 255, 255, 0.05); padding: 20px; border-radius: 15px; margin-bottom: 30px; border: 1px solid rgba(255, 215, 0, 0.2); }
        .judges-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 15px; }
        input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid rgba(255, 215, 0, 0.3); background: rgba(255, 255, 255, 0.1); color: #fff; font-family: 'Poppins', sans-serif; }
        .btn { padding: 12px 24px; background: linear-gradient(135deg, #ff00ff, #00ffff); color: #fff; border: none; border-radius: 25px; cursor: pointer; font-weight: 700; }
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 10px 20px; background: rgba(255, 255, 255, 0.1); border: 2px solid rgba(255, 0, 255, 0.3); border-radius: 20px; cursor: pointer; color: #fff; font-weight: 600; }
        .tab.active { background: linear-gradient(135deg, #ff00ff, #00ffff); border-color: #ff00ff; }
        .round-content { display: none; }
        .round-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: rgba(0, 0, 0, 0.5); }
        th, td { padding: 12px; text-align: center; border: 1px solid rgba(255, 215, 0, 0.2); color: #e0e0ff; }
        th { color: #ffd700; font-weight: 700; background: rgba(255, 215, 0, 0.1); position: relative; cursor: help; }
        th .tooltip { visibility: hidden; width: 300px; background: rgba(0, 0, 0, 0.95); color: #fff; text-align: left; border-radius: 10px; padding: 15px; position: absolute; z-index: 1; bottom: 125%; left: 50%; margin-left: -150px; font-size: 12px; font-weight: normal; border: 2px solid #ff00ff; }
        th:hover .tooltip { visibility: visible; }
        .score-input { width: 60px; padding: 5px; text-align: center; }
        .participant-row { background: rgba(255, 255, 255, 0.02); }
        .total-col { background: rgba(0, 255, 255, 0.1); font-weight: bold; color: #00ffff; }
        .aggregate-table { background: rgba(0, 255, 136, 0.05); }
        .faceoff-table { background: rgba(255, 0, 255, 0.05); }
        .top-scorer { background: rgba(255, 215, 0, 0.1); }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-btn">‚Üê Back to Dashboard</a>
        <h1>{{ event.Event }} - Scorecard</h1>
        
        <h2>Set Judge Names</h2>
        <form method="POST" class="judges-form">
            <input type="hidden" name="action" value="save_judges">
            <div class="judges-grid">
                <input type="text" name="judge1" value="{{ scorecard.judges[0] }}" placeholder="Judge 1 Name">
                <input type="text" name="judge2" value="{{ scorecard.judges[1] }}" placeholder="Judge 2 Name">
                <input type="text" name="judge3" value="{{ scorecard.judges[2] }}" placeholder="Judge 3 Name">
            </div>
            <button type="submit" class="btn">Save Judge Names</button>
        </form>

        <div class="tabs">
            <div class="tab active" onclick="showRound('round1')">Round 1</div>
            <div class="tab" onclick="showRound('round2')">Round 2</div>
            <div class="tab" onclick="showRound('round3')">Round 3</div>
            <div class="tab" onclick="showRound('aggregate')">Aggregate Scores</div>
            <div class="tab" onclick="showRound('faceoff')">Face-off</div>
        </div>

        {% for round_num in ['1', '2', '3'] %}
        <div id="round{{ round_num }}" class="round-content {% if round_num == '1' %}active{% endif %}">
            <h2>Round {{ round_num }} Scoring (50 points max per judge)</h2>
            {% for p in participants %}
            <h3 style="color: #00ffff; margin-top: 30px;">{{ p.participant1_name }} - {{ p.team_name }}</h3>
            <form method="POST">
                <input type="hidden" name="action" value="save_scores">
                <input type="hidden" name="round" value="{{ round_num }}">
                <input type="hidden" name="participant_serial" value="{{ p.serial_number }}">
                <table>
                    <thead>
                        <tr>
                            <th>Criteria</th>
                            <th>{{ scorecard.judges[0] }}</th>
                            <th>{{ scorecard.judges[1] }}</th>
                            <th>{{ scorecard.judges[2] }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th style="text-align: left;">
                                Technical Proficiency (10)
                                <span class="tooltip">Assesses fundamental skills including proper footwork, body alignment, flexibility, and precision.</span>
                            </th>
                            <td><input type="number" name="technical_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_0', {}).get('technical', 0) }}"></td>
                            <td><input type="number" name="technical_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_1', {}).get('technical', 0) }}"></td>
                            <td><input type="number" name="technical_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_2', {}).get('technical', 0) }}"></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">
                                Musicality & Rhythm (10)
                                <span class="tooltip">Evaluates how well the dancer interprets the music, moving in sync with rhythm and dynamics, matching movements to the beat and expressing the mood.</span>
                            </th>
                            <td><input type="number" name="musicality_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_0', {}).get('musicality', 0) }}"></td>
                            <td><input type="number" name="musicality_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_1', {}).get('musicality', 0) }}"></td>
                            <td><input type="number" name="musicality_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_2', {}).get('musicality', 0) }}"></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">
                                Choreography & Creativity (10)
                                <span class="tooltip">Judges the dance's design and originality. Looks for creativity in steps, formations, and overall concept, considering if choreography is unique and well-arranged.</span>
                            </th>
                            <td><input type="number" name="choreography_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_0', {}).get('choreography', 0) }}"></td>
                            <td><input type="number" name="choreography_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_1', {}).get('choreography', 0) }}"></td>
                            <td><input type="number" name="choreography_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_2', {}).get('choreography', 0) }}"></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">
                                Performance & Showmanship (10)
                                <span class="tooltip">Assesses stage presence, energy, and connection with audience. Includes projection, personality, and ability to tell a story or convey emotion.</span>
                            </th>
                            <td><input type="number" name="performance_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_0', {}).get('performance', 0) }}"></td>
                            <td><input type="number" name="performance_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_1', {}).get('performance', 0) }}"></td>
                            <td><input type="number" name="performance_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_2', {}).get('performance', 0) }}"></td>
                        </tr>
                        <tr>
                            <th style="text-align: left;">
                                Stage Presence (10)
                                <span class="tooltip">How well dancers command and utilize the stage. Considers confidence, charisma, and energy.</span>
                            </th>
                            <td><input type="number" name="stage_presence_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_0', {}).get('stage_presence', 0) }}"></td>
                            <td><input type="number" name="stage_presence_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_1', {}).get('stage_presence', 0) }}"></td>
                            <td><input type="number" name="stage_presence_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get(round_num, {}).get(p.serial_number|string, {}).get('judge_2', {}).get('stage_presence', 0) }}"></td>
                        </tr>
                    </tbody>
                </table>
                <button type="submit" class="btn" style="margin-top: 15px;">Save Scores</button>
            </form>
            {% endfor %}
        </div>
        {% endfor %}

        <div id="aggregate" class="round-content">
            <h2>Aggregate Scores (Total of 3 Rounds - Max 450 points)</h2>
            <table class="aggregate-table">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Participant</th>
                        <th>Team</th>
                        <th>Total Score</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in participants|sort(attribute='serial_number') %}
                    {% set score = aggregates.get(p.serial_number|string, 0) %}
                    <tr class="{% if loop.index <= 2 %}top-scorer{% endif %}">
                        <td>{{ loop.index }}</td>
                        <td>{{ p.participant1_name }}</td>
                        <td>{{ p.team_name }}</td>
                        <td class="total-col">{{ score }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div id="faceoff" class="round-content">
            <h2>Face-off (Top 2 Participants - 50 points max)</h2>
            <p style="color: #00ffff; margin-bottom: 20px;">Top 2 participants from aggregate scores compete in the final face-off.</p>
            {% if top_2|length >= 2 %}
                {% for serial, score in top_2 %}
                    {% set p = participants|selectattr('serial_number', 'equalto', serial|int)|first %}
                    {% if p %}
                    <h3 style="color: #ff00ff; margin-top: 30px;">{{ p.participant1_name }} - {{ p.team_name }} (Aggregate: {{ score }})</h3>
                    <p style="color: #e0e0ff; font-size: 14px; margin-bottom: 10px;">Face-off scoring (scores reset for this round)</p>
                    <form method="POST">
                        <input type="hidden" name="action" value="save_scores">
                        <input type="hidden" name="round" value="faceoff">
                        <input type="hidden" name="participant_serial" value="{{ p.serial_number }}">
                        <table class="faceoff-table">
                            <thead>
                                <tr>
                                    <th>Criteria</th>
                                    <th>{{ scorecard.judges[0] }}</th>
                                    <th>{{ scorecard.judges[1] }}</th>
                                    <th>{{ scorecard.judges[2] }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <th style="text-align: left;">Technical Proficiency (10)</th>
                                    <td><input type="number" name="technical_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_0', {}).get('technical', 0) }}"></td>
                                    <td><input type="number" name="technical_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_1', {}).get('technical', 0) }}"></td>
                                    <td><input type="number" name="technical_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_2', {}).get('technical', 0) }}"></td>
                                </tr>
                                <tr>
                                    <th style="text-align: left;">Musicality & Rhythm (10)</th>
                                    <td><input type="number" name="musicality_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_0', {}).get('musicality', 0) }}"></td>
                                    <td><input type="number" name="musicality_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_1', {}).get('musicality', 0) }}"></td>
                                    <td><input type="number" name="musicality_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_2', {}).get('musicality', 0) }}"></td>
                                </tr>
                                <tr>
                                    <th style="text-align: left;">Choreography & Creativity (10)</th>
                                    <td><input type="number" name="choreography_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_0', {}).get('choreography', 0) }}"></td>
                                    <td><input type="number" name="choreography_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_1', {}).get('choreography', 0) }}"></td>
                                    <td><input type="number" name="choreography_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_2', {}).get('choreography', 0) }}"></td>
                                </tr>
                                <tr>
                                    <th style="text-align: left;">Performance & Showmanship (10)</th>
                                    <td><input type="number" name="performance_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_0', {}).get('performance', 0) }}"></td>
                                    <td><input type="number" name="performance_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_1', {}).get('performance', 0) }}"></td>
                                    <td><input type="number" name="performance_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_2', {}).get('performance', 0) }}"></td>
                                </tr>
                                <tr>
                                    <th style="text-align: left;">Stage Presence (10)</th>
                                    <td><input type="number" name="stage_presence_0" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_0', {}).get('stage_presence', 0) }}"></td>
                                    <td><input type="number" name="stage_presence_1" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_1', {}).get('stage_presence', 0) }}"></td>
                                    <td><input type="number" name="stage_presence_2" class="score-input" min="0" max="10" value="{{ scorecard.rounds.get('faceoff', {}).get(p.serial_number|string, {}).get('judge_2', {}).get('stage_presence', 0) }}"></td>
                                </tr>
                            </tbody>
                        </table>
                        <button type="submit" class="btn" style="margin-top: 15px;">Save Face-off Scores</button>
                    </form>
                    {% endif %}
                {% endfor %}
            {% else %}
                <p style="color: #e0e0ff;">Complete all 3 rounds to see top 2 participants for face-off.</p>
            {% endif %}
        </div>
    </div>

    <script>
        function showRound(roundId) {
            document.querySelectorAll('.round-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(roundId).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
